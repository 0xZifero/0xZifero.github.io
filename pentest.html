<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link href="style.css" rel="stylesheet" type="text/css" />
    <title>Zifero</title>
  </head>
  <body>

<h1 id="prise-de-notes-test-d-intrusion">Prise de notes - Test d&#39;intrusion</h1>
<p>Cette proposition de méthodologie par la pratique d&#39;un test de pénétration (ou <em>pentest</em> en anglais) est largement décrite par l&#39;<a href="https://owasp.org">OWASP - The Open Web Application Security Project</a>.</p>
<h2 id="phases-de-reconnaissance">Phases de reconnaissance</h2>
<p>Avant de décortiquer l&#39;application ou le serveur web en lui-même, le but est de se renseigner sur la cible, son écosystème, les services exposés, vérifier son chiffrement, etc.</p>
<h3 id="reconnaissance-passive">Reconnaissance passive</h3>
<p>En ligne, le site <a href="https://www.shodan.io">shodan.io</a> propose un moteur de recherche d&#39;équipements et de services vulnérables. Pour chaque adresse IP le site proposera aussi un assortiment de failles potentielles. Pour compléter cette première collecte d&#39;informations, passer la cible au crible de <a href="https://whois.com/whois/">WHOIS</a> sera également nécessaire.</p>
<p>Ensuite, il est possible d&#39;utiliser des techniques de Google Dork en se basant sur le site <a href="https://exploit-db.com/">DB Exploit</a> qui pourvoit la <a href="https://www.exploit-db.com/google-hacking-database">Base de données</a> qui fait office de référence en la matière.</p>
<p>Possible d&#39;utiliser l&#39;outil de récolte de données <a href="https://github.com/laramies/theHarvester">theHarvester</a> ou encore l&#39;outil proposé à cet effet par l&#39;OWASP dénommé <a href="https://github.com/OWASP/Amass">Amass</a> dont il faudra éviter d&#39;utiliser l&#39;option <em>-active</em> pour ne pas laisser de traces de son passage sur le serveur cible.</p>
<p>Quelques outils pour cette phase de recueil d&#39;informations afin - notamment - de réaliser des énumérations de DNS, de réseaux et d&#39;e-mails :</p>
<ul>
<li>whois</li>
<li>host</li>
<li>nslookup</li>
<li>dig</li>
<li>theHarvester</li>
<li>traceroute</li>
<li>netdiscover</li>
<li>arpscan</li>
<li>fping --quiet --alive --generate <adresse IP du réseau></li>
</ul>
<p>Des <em>frameworks</em> de collecte de données peuvent aussi être utiles pour automatiser une partie des tâches :</p>
<ul>
<li><a href="https://www.github.com/i3visio/osrframework">OSRFframework</a></li>
<li><a href="https://www.maltego.com">Maltego</a></li>
<li><a href="https://www.spiderfoot.net/">spiderfoot</a></li>
<li><a href="https://www.github.com/lanmaster53/recon-ng">Recon-NG</a></li>
</ul>
<p>Arpenter les réseaux sociaux est également enrichissant à cet effet.</p>
<p>La structure d&#39;un site est intéressante à explorer dans la mesure où les fichiers qui le compose sont souvent génériques.
L&#39;aide de quelques commandes Linux est appréciable :</p>
<ul>
<li>les liens vers les réseaux sociaux ou les noms et adresses mail qui peuvent être affichées sont à noter</li>
<li>www.lesite.com/robots.txt : le fichier robots.txt sert a orienter les crawlers des moteurs de recherche</li>
<li>www.lesite.com/sitemap.xml ou /sitemaps.xml : ce fichier xml décrit l&#39;organisation du site au profit des moteurs de recherche</li>
<li>la commande <code>host</code> permettra de déterminer l&#39;adresse IP du site cible (c&#39;est une méthode parmi d&#39;autres)</li>
<li>certains add-on de navigateurs sont utiles lors de cette phase : built-in, wappalyzer.</li>
<li>la commande <code>whatweb</code> fournira un descriptif technique du site</li>
<li>enfin, la copie complète du site web peut être réalisée gràce à HTTrack Website Copier</li>
</ul>
<p>Une énumération par WHOIS permettra d&#39;agrémenter les données collectées :</p>
<ul>
<li>par l&#39;utilisation de la commande <code>whois</code> sur Linux</li>
<li>obtenir le nom de serveur d&#39;un domaine</li>
</ul>
<p>Le footprinting d&#39;un site peut-être réalisé :</p>
<ul>
<li>gràce à l&#39;outil <a href="https://www.netcraft.com">Netcraft</a> qui permet de connaître les technologies utilisées (SSL/TLS...) et d&#39;autres éléments comme l&#39;appartenance à certains blocs d&#39;adresses IP, les trackers en place (Google Analytics...) ou certaines vulnérabilités</li>
<li>et complété par DNSRECON qui est un programme en python disponible sur Kali pour obtenir davantage d&#39;informations sur l&#39;environnement immédiat de la cible</li>
<li>tout comme le site <a href="https://www.dnsdumpster.com">DNSdumpster</a> qui permet des graphiques lisibles et compréhensibles de l&#39;organisation de la cible</li>
</ul>
<pre><code class="lang-bash">whois hackerslpoit<span class="hljs-meta">.org</span>
</code></pre>
<pre><code class="lang-bash">dnsrecon -d hackersploit<span class="hljs-meta">.org</span>
</code></pre>
<p>Un WAF (Web Application Firewall) peut être décelé avec l&#39;outil <em>wafw00f</em>. L&#39;objectif serait de déterminer si un site web ou une application est protégée par un service du type CloudFlare et n&#39;affiche pas directement sa propre adresse IP de manière évidente.</p>
<pre><code class="lang-bash">wafw00f -<span class="hljs-selector-tag">a</span> hackersploit.org
</code></pre>
<p>L&#39;énumération de sous-domaine peut elle être réalisée par l&#39;outil <em>sublist3r</em>. Cet outil n&#39;est pas directement installé sur Kali Linux bien qu&#39;il soit disponible sur le repository de Kali. Il nécessite donc d&#39;être installé. Il est intéressant de savoir que <em>sublist3r</em> dispose aussi d&#39;une capacité de bruteforce qui n&#39;est pas recommandée dans la phase de reconnaisse passive.</p>
<pre><code class="lang-bash"><span class="hljs-symbol">sudo</span> apt-<span class="hljs-meta">get</span> install <span class="hljs-keyword">sublist3r
</span><span class="hljs-keyword">sublist3r </span>-d ine.com
</code></pre>
<p>Comme évoqué plus haut, le Google Dorking (ou Google Hacking ou Google Dorks) permet d&#39;obtenir des résultats ciblé en utilisant des mots clés du moteur de recherche.
Ceux-ci peuvent être :</p>
<ul>
<li>site: (pour limiter la recherche à un nom de domaine et ses sous-domaines avec par exemple <em>.ine.com</em>)</li>
<li>inurl: (limiter la recherher au contenu de l&#39;URL comme par exemple <em>admin</em> ou <em>auth_user_file.txt</em> ou <em>password.txt</em>)</li>
<li>intitle: (déterminer un terme contenu dans le titre de la page comme par exemple <em>admin</em> ou la faille très réputée <em>index of</em>)</li>
<li>filetype: (limiter les résultats à un type de fichier comme par exemple <em>pdf</em> ou <em>docx</em> ou <em>zip</em>)</li>
<li>cache: (pour retrouver l&#39;ancienne version d&#39;un site ou une archive tout comme le ferait le site <a href="https://archive.org/">WayBackMachine</a>)</li>
</ul>
<p>En détail, l&#39;outil <a href="https://github.com/laramies/theHarvester">theHarvester</a> permet de collecter des adresses mail liées à un domaine internet.</p>
<pre><code class="lang-bash">theHarvester -d hackersploit<span class="hljs-selector-class">.org</span> -<span class="hljs-selector-tag">b</span> google, linkedin, yahoo, dnsdumpster
</code></pre>
<p>Enfin, pour compléter le tout, l&#39;utilisation d&#39;une base de données regroupant des <em>leaks</em> permettra éventuellement de mettre la main sur des listes de mots de passe ou d&#39;autres données concernant la cible.
Plusieurs sont disponibles :</p>
<ul>
<li><a href="https://haveibeenpwned.com/">haveIbeenPwned</a></li>
<li><a href="http://monitor.firefox.com/">Firefox Monitor</a></li>
<li><a href="https://www.dehashed.com/">Dehashed</a></li>
</ul>
<h3 id="reconnaissance-active">Reconnaissance active</h3>
<p>L&#39;outil <a href="https://github.com/OWASP/Amass">Amass</a> pourra toujours être utilisé pour renforcer la connaissance de la cible en activant l&#39;option <code>-active</code> dans la formulation des requêtes.</p>
<p>Réaliser un scan de ports avec les outils dont le plus connu est <a href="https://nmap.org/">Nmap</a>.</p>
<p><strong>Attention</strong> car l&#39;utilisation de cet outil peut ne pas être très discrète en fonction des options utilisées. Un scan &quot;silencieux&quot; pourra être réalisé grâce aux options <code>-sS</code> ; c&#39;est le type de scan réalisé par défaut.</p>
<p>L&#39;attribution des ports est réalisée par l&#39;<a href="https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml">IANA</a> donc le résultat attendu est supposé conforme aux recommandations de cette autorité de l&#39;Internet.</p>
<p>La découverte du système d&#39;exploitation de la cible peut être réalisée grâce à la commande suivante : </p>
<pre><code class="lang-bash">nmap -sS -O scanme<span class="hljs-selector-class">.namp</span><span class="hljs-selector-class">.org</span>
</code></pre>
<p>Pour obtenir davantage d&#39;informations, il est possible de cherche à définir les versions des services qui tournent sur le terminal cible :</p>
<pre><code class="lang-bash">nmap -sV scanme<span class="hljs-selector-class">.nmap</span><span class="hljs-selector-class">.org</span>
</code></pre>
<p>Pour forcer la découverte de type ICMP :</p>
<pre><code class="lang-bash"><span class="hljs-symbol">nmap</span> -PE -<span class="hljs-meta">sn</span> -n &lt;<span class="hljs-keyword">adresse </span><span class="hljs-built_in">IP</span> du réseau&gt;
</code></pre>
<p>Quelques outils supplémentaires pour cette phase de recueil d&#39;informations visant à énumérer différent protocoles (SMB, NFS, SMTP, SNMP, LDAP, Active Directory) ainsi que des bases de données et des serveurs web :</p>
<ul>
<li>Nmap (sans le scan de ports avec l&#39;option -sn en premier lieu)</li>
<li>netdiscover</li>
<li>enum4linux</li>
<li>smbmap</li>
<li>CrackmapExec</li>
<li>SQLmap</li>
<li><a href="http://www.cirt.net/Nikto2">Nikto</a></li>
<li>dirb</li>
<li>wfuzz</li>
<li>gobuster</li>
<li>wpscan</li>
</ul>
<pre><code class="lang-bash"><span class="hljs-keyword">nmap</span> -<span class="hljs-keyword">sn</span> -PS // permet de réaliser <span class="hljs-keyword">la</span> découverte des hôtes actifs sans scanner les ports
<span class="hljs-keyword">nmap</span> -Pn -n -sV --script default -pPORT1, PORT2, PORT3 &lt;adresse IP de <span class="hljs-keyword">la</span> cible&gt;
<span class="hljs-keyword">nmap</span> -Pn -sU -F -sV -O -sC //pour un scan discret sur les ports les plus courants avec détection de <span class="hljs-keyword">la</span> <span class="hljs-keyword">version</span> des services et du systè<span class="hljs-keyword">me</span> d<span class="hljs-string">'exploitation utilisés ainsi qu'</span>une application des scripts Nmap par défaut sur les ports ouverts
<span class="hljs-keyword">nmap</span> -T[<span class="hljs-number">0</span>-<span class="hljs-number">5</span>] -oN doc.txt //pour réguler <span class="hljs-keyword">la</span> vitesse de scan et produire un fichier avec les résultats de <span class="hljs-keyword">la</span> commande (doc.xml)
<span class="hljs-keyword">nmap</span> -Pn -sS -F //pour un stealth scan sur les ports les plus courants
</code></pre>
<p>Pour utiliser le scripting par défaut de Nmap (NSE : Nmap Scripting Engine) et approfondir la collecte de données concernant la détection de système d&#39;exploitation, la liste des scripts Nmap est disponible ici : /usr/share/nmap/scripts/</p>
<pre><code class="lang-bash"><span class="hljs-keyword">ls</span> -<span class="hljs-keyword">al</span> /usr/share/<span class="hljs-keyword">nmap</span>/scripts/
<span class="hljs-keyword">ls</span> -<span class="hljs-keyword">al</span> /usr/share/<span class="hljs-keyword">nmap</span>/scripts/ | <span class="hljs-keyword">grep</span> -<span class="hljs-keyword">e</span> <span class="hljs-string">"http"</span>
<span class="hljs-keyword">nmap</span> -h
<span class="hljs-keyword">nmap</span> -A //AGRESSIVE SCAN peu discret qui est un raccourci pour scanner les services et systè<span class="hljs-keyword">me</span> d<span class="hljs-string">'exploitation</span>
</code></pre>
<p>Le spoofing d&#39;IP est rendu possible comme suit :</p>
<pre><code class="lang-bash">nmap -Pn -sS -sV -p445,<span class="hljs-number">3389</span> -f --data-lenght <span class="hljs-number">200</span> -D <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.200</span> <span class="hljs-comment">//spoofing de l'adresse 192.168.1.1 (gateway) avec des paquets fragmentés de taille 200</span>
</code></pre>
<p>Énumération avec Nikto :</p>
<pre><code class="lang-bash"><span class="hljs-symbol">nikto</span> -h &lt;<span class="hljs-keyword">adresse </span><span class="hljs-built_in">IP</span> de la cible&gt;
</code></pre>
<p>La commande ci-après qui utilise Gobuster permet d&#39;énumérer un serveur web pour y déceler des répertoires en se basant sur un dictionnaire tout en testant certaines extensions pour recherche d&#39;éventuels fichiers :</p>
<pre><code class="lang-bash">gobuster <span class="hljs-keyword">dir</span> --url &lt;adresse IP <span class="hljs-keyword">de</span> <span class="hljs-keyword">la</span> cible&gt; --wordlist /usr/share/wordlists/directory-<span class="hljs-keyword">list</span>-2.3-medium.txt -x html,php,txt
</code></pre>
<p>Le <em>Domain Name Server</em> utilise des NS ou <em>nameservers</em> qui sont similaires à des répertoires téléphoniques listant la correspondance entre adresses IP et noms de domaines. Cloudflare (1.1.1.1) et Google (8.8.8.8) possèdent par exemple leurs propres DNS.</p>
<p>Le <em>DNS Zone Transfer</em> est notamment décrit par ici sur <a href="https://digi.ninja/projects/zonetransferme.php">ZoneTransfer</a>. </p>
<p>L&#39;énumération active de DNS peut être réalisée gràce à la commande <em>dnsenum</em> puis appronfondie avec les outils <em>dig</em> et/ou <em>fierce</em> présents dans Kali Linux.</p>
<pre><code class="lang-bash">dnsenum zonetransfer.<span class="hljs-keyword">me</span>
</code></pre>
<h2 id="identifier-les-services-vuln-rables">Identifier les services vulnérables</h2>
<p>Une fois que le profil de la cible est un peu plus affiné, il faudra partir en quête des vulnérabilités qui peuvent éventuellement exister sur un service donné dans une version donnée.</p>
<p>A cet effet, outre une recherche Google, il faut consulter les CVE (Common Vulnerability Exposure) qui impactent possiblement les services identifiés :</p>
<ul>
<li><a href="https://cve.mitre.org/index.html">MITRE</a></li>
<li><a href="https://www.cve.org/">CVE Program</a></li>
<li><a href="https://www.cvedetails.com/">CVE Details</a></li>
<li><a href="https://www.cert.ssi.gouv.fr/alerte/">CERT ANSSI</a></li>
</ul>
<p>En guise de ressources, quelques outils :</p>
<ul>
<li><a href="https://fr.tenable.com/products/nessus/nessus-essentials">Nessus</a></li>
<li>OpenVAS</li>
<li>nikto et Nmap (déjà vus plus haut) s&#39;accompagnent aussi de capacités de détection de vulnérabilités</li>
<li>WPscan</li>
</ul>
<p>Un exemple de recherche de vulnérabilités :</p>
<pre><code class="lang-bash">wpscan --url http://&lt;adresse IP <span class="hljs-keyword">ou</span> URL de <span class="hljs-keyword">la</span> cible&gt;/<span class="hljs-keyword">wp</span>
</code></pre>
<p>Complété par la commande suivante pour lister les utilisateurs enregistrés d&#39;une instance WordPress :</p>
<pre><code class="lang-bash">wpscan --url http://&lt;adresse IP <span class="hljs-keyword">ou</span> URL de <span class="hljs-keyword">la</span> cible&gt;/<span class="hljs-keyword">wp</span> --enumerate <span class="hljs-keyword">u</span>
</code></pre>
<h3 id="v-rification-de-la-qualit-du-chiffrement">Vérification de la qualité du chiffrement</h3>
<p>Il faut pouvoir jauger :</p>
<ol>
<li>la qualité du certificat utilisé, qui pourrait en faciliter la falsification par un attaquant si insuffisante (la taille de clé du certificat, qui ne doit pas être trop faible i.e. inférieure à  2 048 bits et l&#39;algorithme de hachage de type SHA-256 avec RSA ou supérieur) ;</li>
<li>les protocoles proposés par le serveur, qui peuvent contenir des défauts d’implémentation ;</li>
<li>les suites de chiffrement proposées, parfois faibles ;</li>
<li>la librairie utilisée pour le chiffrement, qui peut comporter des vulnérabilités.</li>
</ol>
<p>Quelques outils existent pour automatiser ces tâches :</p>
<ul>
<li><a href="https://www.ssllabs.com/ssltest/">SSLlabs</a></li>
<li><a href="https://github.com/rbsec/sslscan">SSLscan</a></li>
<li><a href="https://github.com/drwetter/testssl.sh">testssl.sh</a></li>
</ul>
<h2 id="exploitation">Exploitation</h2>
<p>Après la reconnaissance passive puis active et faisant suite aux scans de réseaux et des vulnérabilités, la phase d&#39;exploitation a pour but de compromettre la cible en s&#39;engouffrant dans une des failles décelées. Il s&#39;agira de mettre en oeuvre un <em>exploit</em> combiné à une <em>payload</em> pour s&#39;immiscer dans le terminal cible.</p>
<p>Pour ce faire, il faudra sélectionner l&#39;<em>exploit</em> idoine dans l&#39;<a href="https://www.exploit-db.com/">Exploit Database</a> et certainement l&#39;adapter (selon le langage de programmation utilisé) pour y charger la <em>payload</em> voulue en fonction de l&#39;effet recherché sur cible (comme par exemple la génération d&#39;un <em>reverse shell</em>).</p>
<p>Pour faciliter cette recherche, l&#39;outil suivant en ligne de commande <em>searchploit</em> pourra servir :</p>
<pre><code class="lang-bash"><span class="hljs-title">searchsploit</span> -www wordpress mail <span class="hljs-class"><span class="hljs-keyword">data</span></span>
</code></pre>
<p>La commande précédente va rechercher les failles connues du <em>plugin</em> WordPress Mail Masta et donnera l&#39;URL correspondant sur <em>Exploit Database</em> si elles existent avec l&#39;option <code>-www</code>.</p>
<h2 id="post-exploitation">Post-exploitation</h2>
<p>Une fois l&#39;accès acquis sur une nouvelle machine par le biais d&#39;un profil utilisateur, l&#39;idée sera alors de chercher à acquérir de nouveaux privilèges sur la cible ou de nouveaux accès à travers celle-ci. Une nouvelle phase d&#39;énumération devra être conduite pour obtenir une élévation de privilèges, le maintien de l&#39;accès ou pour réaliser un mouvement latéral (saut vers un autre utilisateur du terminal) voire un <em>pivoting</em> (saut vers un autre réseau jusque-là non atteignable).</p>
<p>Les scripts de <a href="https://www.github.com/carlospolop/privilege-escalation-awesome-scripts-suite">PEASS - Privilege Escalation Awesome Scripts SUITE</a> peuvent aider a atteindre ce but.</p>
<p>De plus, quelques outils supplémentaires aideront à la post-exploitation :</p>
<ul>
<li><a href="https://gtfobins.github.io/">GTFOBins</a></li>
<li><a href="https://www.hackingparticles.in/ctf-challenges-walkthrough">Hacking Articles</a></li>
</ul>

    
  </body>
</html>
